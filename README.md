# 🎬 AI Film Studio - 使用说明

> 一步一步来，不会跳步骤，傻子看完都会。

---

## 第一步：安装依赖库

打开 VSCode，确认你已经在 venv 虚拟环境里（终端左边应该有 `(venv)` 字样）。

在终端输入下面这行命令，然后按回车：

```
pip install -r requirements.txt
```

等它装完（会出现一堆文字滚动，最后出现 `Successfully installed` 就是成功了）。

---

## 第二步：启动程序

打开vscode此文件夹下的终端，在终端输入：

python app.py

看到这个就说明启动成功了：
```
==================================================
AI Film Studio 启动成功！
请在浏览器打开: http://127.0.0.1:5000
==================================================
```

---

## 第三步：打开网页

打开你的浏览器（Chrome/Edge 都行），在地址栏输入：

```
http://127.0.0.1:5000
```

按回车，就能看到编辑器界面了。

---

## 第四步：配置 API（必须先做这一步）

点击右上角的 **⚙ 设置** 按钮，填入：

| 字段 | 说明 | 示例 |
|------|------|------|
| LLM API 地址 | 你的大模型 API 地址 例如| `https://api.openai.com/v1` |
| LLM API Key | 你的 API 密钥 例如| `sk-xxxxxxxx` |
| LLM 模型名 | 使用的模型 例如| `gpt-4o` 或 `deepseek-chat` |
| （不懂可以不填）ComfyUI 地址 | 本地 ComfyUI 的地址 例如| `http://127.0.0.1:8188` |

填完点 **保存设置**。

> 💡 如果你用的是国内大模型（比如 DeepSeek、通义千问），把 API 地址换成对应的地址就行，其他操作完全一样。

---

## 第五步：制作一场戏的流程

### 5.1 放置节点

点击顶部工具栏的按钮来添加节点，节点会出现在画布上。

**推荐顺序（从左到右放）：**

## 你需要准备的：剧本或分镜的文本，角色图片（可选），环境图片（可选）

```
[角色输入] ──────────────────────────────────────────→ [关键帧生成] → [镜头视频生成]
[环境输入]↗                                           ↗
      （手动添加模块）       （自动添加模块）      （自动添加模块）        （手动添加模块） 
[剧本输入] ——————→ [分镜生成] ——————→ [图片描述生成] ————————→ [关键帧生成] ————————→ [镜头视频生成]
                       ↘ [视频描述生成]  ———————————————————————————————————————↗
如果有现成分镜，直接在剧本模块导入分镜，并说明优化分镜即可
```

### 5.2 连线

- 每个节点右侧有一个 **蓝色圆点**（输出端口）
- 每个节点左侧有一个 **蓝色圆点**（输入端口）
- **按住输出端口拖动**，拖到另一个节点的输入端口上松开，就连上了
- 想删除连线的话 ，删除模块同时会删除连线
##通过部分模块后，会自动生成并链接下一模块

## 通过分镜生成模块，会自动分解每条分镜并生成相应数量的分镜文本（每条文本包含一条分镜）

## 通过分镜文本模块，会自动生成并接入图片描述生成模块

## 通过图片描述生成模块，会自动生成并接入视频描述生成模块

## 其余部分模块皆需要手动添加连线


### 5.3 填写内容并执行

双击或点击节点上的 **✎ 打开** 按钮，弹出详情窗口：

1. **输入节点**（角色/环境/剧本）：点击上传区域，选择文件上传
2. **输出节点**：填写自定义要求，点击 **▶ 执行生成**

### 5.4 节点颜色含义

| 颜色 | 含义 | 操作 |
|------|------|------|
| 🔘 灰色 | 未执行 | 打开节点，点执行 |
| 🟡 黄色（闪烁） | 正在生成中 | 等待... |
| 🟢 绿色 | 生成完成，待审核 | 查看结果，满意点【通过】，不满意点【刷新】 |
| 🔵 蓝色 | 已通过，锁定 | 下游节点可以使用这个结果了 |
| 🔴 红色 | 执行失败 | 点【查看错误】看原因，点【重试】再试一次 |

### 5.5 审核与刷新

- 节点变绿后，点 **✎ 编辑** 可以手动修改生成的文本
- 点 **✔ 通过** 锁定结果，下游节点才能使用
- 点 **↺ 刷新** 重新生成（会自动让下游节点变灰，需要重新执行）

---

## 第六步：关键帧图片生成（Output_KeyPic）

这个节点需要 **ComfyUI 在本地运行**。

1. 打开节点，选择生成模式：**仅首帧** 或 **首尾帧**
镜头编号（比如 `1_1` 表示第1场第1个镜头）
3. 在 **ComfyUI Workflow JSON** 框里，粘贴你自己的 ComfyUI API 格式 Workflow
   - 打开 ComfyUI → 右上角菜单 → `Save (API Format)` → 复制内容粘贴进来
   - Workflow 里用 `{{positive_prompt}}` 和 `{{negative_prompt}}` 作为占位符，程序会自动替换
4. 点 **▶ 执行生成**
5. 生成后最多显示3张图，点击图片选择你想用的那张

---

## 第七步：镜头视频生成（Output_Video）

1. 确保上游的 **关键帧生成** 节点已经通过（蓝色）
2. 在关键帧节点里点击选中你想用的图片
3. 打开视频节点，填写镜头编号（要和关键帧节点的编号对应）
4. 粘贴你的图生视频 Workflow JSON
5. 点 **▶ 执行生成**

---
一条完整路线如下


## 常见问题

**Q: 终端里没有 `(venv)` 怎么办？**
在终端输入：
```
venv\Scripts\activate
```

**Q: `pip install` 报错说找不到 pip？**
```
python -m pip install -r requirements.txt
```

**Q: 浏览器打开是空白页？**
确认终端里 `python app.py` 还在运行（没有报错），然后刷新浏览器。

**Q: 调用 LLM 报错 "401"？**
API Key 填错了，或者 API 地址不对。

**Q: ComfyUI 连接失败？**
确认 ComfyUI 已经启动，地址默认是 `http://127.0.0.1:8188`。

**Q: 关闭程序后数据还在吗？**
在，所有数据保存在 `cache/project_state.json` 文件里，重新启动 `python app.py` 后自动恢复。

---

## 停止程序

在终端里按 `Ctrl + C` 即可停止。
